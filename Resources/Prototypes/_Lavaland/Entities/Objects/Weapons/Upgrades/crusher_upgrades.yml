# Important Note!
# Crusher upgrade entities have the exact same ID as their respective TagPrototype.
# Remember to take this into account when adding new upgrades!

# Main Upgrades
- type: entity
  id: BaseCrusherUpgradeMain
  parent: [BaseItem, BaseSecurityCargoContraband]
  name: "капсула покращення дробарки"
  description: "Модкіт для дробаркової зброї."
  abstract: true
  components:
  - type: Sprite
    sprite: _Lavaland/Objects/Weapons/Upgrades/crusher.rsi
  - type: Item
    size: Small
  - type: GunUpgrade
  - type: StaticPrice
    price: 750
  - type: Tag
    tags:
    - CrusherUpgradeMain

- type: entity
  id: CrusherUpgradeMainMarker
  parent: BaseCrusherUpgradeMain
  name: "капсула покращення дробарки (кінетичний маркер)"
  description: "Компактний генератор блюспейс-поля, який можна вистрілити в живу ціль, щоб зробити її вразливішою до атак дробарки. Його снаряд також може руйнувати деякі типи породи."
  components:
  - type: Sprite
    layers:
    - state: base
    - state: kinetic-marker
  - type: GunUpgrade
    name: gun-upgrade-crusher-kinetic-marker-name
    uniqueGroup: mainUpgrade
  - type: GunUpgradeComponents
    components:
    - type: AmmoCounter
    - type: UseDelayOnShoot
    - type: GunRequiresWield
    - type: Gun
      soundGunshot: /Audio/Weapons/plasma_cutter.ogg
      fireRate: 1
      useKey: false
    - type: MapRestrictedGun
      planetWhitelist:
        components:
        - Biome
      popupOnBlock: gun-lavaland-restricted-message
    - type: RechargeBasicEntityAmmo
      rechargeCooldown: 1
      rechargeSound:
        path: /Audio/Weapons/Guns/MagIn/kinetic_reload.ogg
    - type: BasicEntityAmmoProvider
      proto: BulletCharge
      capacity: 1
      count: 1
  - type: Tag
    tags:
    - CrusherUpgradeMain
    - CrusherUpgradeMainMarker

- type: entity
  id: CrusherUpgradeMainRudeBuster
  parent: BaseCrusherUpgradeMain
  name: "капсула покращення дробарки (Руд Бастер)"
  description: "Фокусується рішучість користувача та випромінюється як напівмагічний снаряд. Усередині постійно видно, як щось відскакує."
  components:
  - type: Sprite
    layers:
    - state: base
    - state: rude-buster
  - type: GunUpgrade
    name: gun-upgrade-crusher-rude-buster-name
    uniqueGroup: mainUpgrade
  - type: GunUpgradeComponents
    components:
    - type: AmmoCounter
    - type: UseDelayOnShoot
    - type: GunRequiresWield
    - type: Gun # TODO turn it into an action gun and add auto-targeting
      projectileSpeed: 12 # Needed for the trail to look good
      soundGunshot: /Audio/Weapons/plasma_cutter.ogg
      fireRate: 0.125
      useKey: false
    - type: MapRestrictedGun
      planetWhitelist:
        components:
        - Biome
      popupOnBlock: gun-lavaland-restricted-message
    - type: RechargeBasicEntityAmmo
      rechargeCooldown: 8
      rechargeSound:
        path: /Audio/Weapons/Guns/MagIn/kinetic_reload.ogg
    - type: BasicEntityAmmoProvider
      proto: ProjectileRudeBuster
      capacity: 1
      count: 1
  - type: Tag
    tags:
    - CrusherUpgradeMain
    - CrusherUpgradeMainRudeBuster

# Blade upgrades
- type: entity
  id: BaseCrusherUpgradeBlade
  parent: [BaseItem, BaseSecurityCargoContraband]
  name: "покращення клинка дробарки"
  description: "Модкіт для дробаркової зброї."
  abstract: true
  components:
  - type: Sprite
    sprite: _Lavaland/Objects/Weapons/Upgrades/crusher.rsi
  - type: Item
    size: Small
  - type: GunUpgrade
  - type: StaticPrice
    price: 500
  - type: Tag
    tags:
    - CrusherUpgradeBlade

- type: entity
  id: CrusherUpgradeBladeLavaAspect
  parent: BaseCrusherUpgradeBlade
  name: "покращення клинка дробарки (лавовий аспект)"
  description: "Кристал із невистиглої лави, через що він постійно гарячий і дуже займистий."
  components:
  - type: Sprite
    state: lava-shard
  - type: GunUpgrade
    name: gun-upgrade-crusher-lava-aspect
  - type: WeaponUpgradeDamage
    bonusDamage:
      types:
        Heat: 5
  - type: WeaponUpgradeEffects
    effects:
    - !type:FlammableReaction
      multiplier: 2
      multiplierOnExisting: 0.5
    - !type:Ignite
    - !type:AdjustTemperature
      amount: 7500 # thermal energy, not temperature!
  - type: Construction
    graph: CrusherUpgradeLavaCrystalConstructionGraph
    node: crystal
  - type: Tag
    tags:
    - CrusherUpgradeBlade
    - CrusherUpgradeBladeLavaAspect

- type: entity
  id: CrusherUpgradeBladeIceFrost
  parent: BaseCrusherUpgradeBlade
  name: "покращення клинка дробарки (крижаний іній)"
  description: "Кристал, що випромінює холод, ймовірно, порушуючи закони термодинаміки."
  components:
  - type: Sprite
    state: ice-shard
  - type: GunUpgrade
    name: gun-upgrade-crusher-ice-frost
  - type: WeaponUpgradeDamage
    bonusDamage:
      types:
        Cold: 4 # Less because no armors protect from it
  - type: WeaponUpgradeEffects
    effects:
    - !type:AdjustTemperature
      amount: -7500 # thermal energy, not temperature! That's not that great actually, but it slows down the target after enough hits
  - type: Construction
    graph: CrusherUpgradeIceCrystalConstructionGraph
    node: crystal
  - type: Tag
    tags:
    - CrusherUpgradeBlade
    - CrusherUpgradeBladeIceFrost

- type: entity
  id: CrusherUpgradeBladeSharpness
  parent: BaseCrusherUpgradeBlade
  name: "покращення клинка дробарки (гострота)"
  description: "Простий точильний камінь, що збільшує шкоду дробарки."
  components:
  - type: Sprite
    state: black-shard
  - type: GunUpgrade
    name: gun-upgrade-crusher-sharpness
  - type: WeaponUpgradeDamage
    bonusDamage:
      types:
        Slash: 7 # Let's just say crusher hammer becomes extra-sharp on the sides
  - type: Construction
    graph: CrusherUpgradeCrystalConstructionGraph
    node: crystal
  - type: Tag
    tags:
    - CrusherUpgradeBlade
    - CrusherUpgradeBladeSharpness

# Handle upgrades
- type: entity
  id: BaseCrusherUpgradeHandle
  parent: [BaseItem, BaseSecurityCargoContraband]
  name: "покращення руків’я дробарки"
  description: "Модкіт для дробаркової зброї."
  abstract: true
  components:
  - type: Sprite
    sprite: _Lavaland/Objects/Weapons/Upgrades/crusher.rsi
  - type: Item
    size: Small
  - type: GunUpgrade
  - type: StaticPrice
    price: 500
  - type: Tag
    tags:
    - CrusherUpgradeHandle

- type: entity
  id: CrusherUpgradeHandleWeights
  parent: BaseCrusherUpgradeHandle
  name: "покращення руків’я дробарки (обважнене)"
  description: "Набір обважнювачів, які можна прикріпити до руків’я, щоб зброя відштовхувала ворогів ударами."
  components:
  - type: Sprite
    state: handle-weights
  - type: GunUpgrade
    name: gun-upgrade-crusher-weights
  - type: GunUpgradeComponents
    components:
    - type: FlipOnHit
    - type: MeleeThrowOnHit
      distance: 3
      speed: 3
  - type: Tag
    tags:
    - CrusherUpgradeHandle
    - CrusherUpgradeHandleWeights

- type: entity
  id: CrusherUpgradeHandleLight
  parent: BaseCrusherUpgradeHandle
  name: "покращення руків’я дробарки (полегшене)"
  description: "Полегшена заміна руків’я, що дозволяє атакувати частіше."
  components:
  - type: Sprite
    state: handle-lightweight
  - type: GunUpgrade
    name: gun-upgrade-crusher-lightweight
  - type: WeaponUpgradeSpeed
    attackRateMultiplier: 1.3 # 30% faster
  - type: Tag
    tags:
    - CrusherUpgradeHandle
    - CrusherUpgradeHandleLightweight

- type: entity
  id: CrusherUpgradeHandleRange
  parent: BaseCrusherUpgradeHandle
  name: "покращення руків’я дробарки (довге)"
  description: "Довга заміна руків’я, що дозволяє атакувати частіше."
  components:
  - type: Sprite
    state: handle-spikes # Why spikes improve range? Cuz they're badass.
  - type: GunUpgrade
    name: gun-upgrade-crusher-range
  - type: WeaponUpgradeRange
    rangeMultiplier: 1.2 # 20% longer
  - type: Tag
    tags:
    - CrusherUpgradeHandle
    - CrusherUpgradeHandleRange

- type: entityTable
  id: CrusherUpgradesMain
  table: !type:GroupSelector
    children:
    - id: CrusherUpgradeMainMarker
    - id: CrusherUpgradeMainRudeBuster

- type: entityTable
  id: CrusherUpgradesBlade
  table: !type:GroupSelector
    children:
    - id: CrusherUpgradeBladeLavaAspect
    - id: CrusherUpgradeBladeIceFrost
    - id: CrusherUpgradeBladeSharpness

- type: entityTable
  id: CrusherUpgradesHandle
  table: !type:GroupSelector
    children:
    - id: CrusherUpgradeHandleWeights
    - id: CrusherUpgradeHandleLight
    - id: CrusherUpgradeHandleRange

- type: entityTable
  id: CrusherUpgrades
  table: !type:GroupSelector
    children:
    - !type:NestedSelector
      tableId: CrusherUpgradesMain
    - !type:NestedSelector
      tableId: CrusherUpgradesBlade
    - !type:NestedSelector
      tableId: CrusherUpgradesHandle
      weight: 2 # They are uncraftable for now so need more chances
